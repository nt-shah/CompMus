---
title: "Computational Musicology - Portfolio"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: flatly
    self_contained: false
   
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}

library(tidyverse)
library(usethis)
library(remotes)
library(spotifyr)
library(ggplot2)
library(compmus)
library(purrr)
library(tidymodels)
library(ggdendro)
library(heatmaply)

token = spotifyr::get_spotify_access_token()
```

### Introduction: An analysis of the Indian music 

My corpus is a small bubble of Indian music - it includes some Indian rap, Indie Indian music (in English and Hindi), old-school Indian (Hindi) music (mainly from old Bollywood films), contemporary classical music (instrumental; predominantly by Anoushka Shankar, a contemporary sitar player), contemporary music inspired by/with strands from Indian classical music and experimental Indie music by an artist called Lifafa (he has a very wide range of sounds and voice, which makes him a very interesting artist). Since contemporary Indian music pulls strands or takes inspiration from old music or Indian classical music, I thought it would be interesting to see commonalities between these groups and speculate what kind of influences more modern music has.

My corpus isn't perfect, given that it does feature two artists quite prominently, Lifafa and Anoushka Shankar. This does stem from my preference for their music. However, I do think I have covered or attempted to cover quite a few categories of Indian music, some mainstream pieces (especially the old film music) and quite some niche or independent music / artists. The project becomes an interesting exploration into the crossing influences across genres, and hopefully the possibility to identify what makes certain music unique or see how artists have applied influences but come up with their own style in the process.

The most typical music in my corpus would be the mainstream old Bollywood film music. But more interestingly, all the music by Lifafa is quite atypical, because he is a very experimental artist who loves playing around with sounds. I intend to dedict a more in-depth analysis to Lifafa's repertoire of music. Additionally, Lifafa is also part of a musical group called 'Peter Cat Recording Co.', whose music is also present in my corpus. It would also be interesting to compare his individual music repertoire and his band work as well.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/5Tnp5uJA1vLwa9QcdGbvVC?utm_source=generator" width="100%" height="380" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>


### Hierarchical Clustering

```{r, echo=FALSE}
myCorpus <-
  get_playlist_audio_features("CM Corpus FINAL", "5Tnp5uJA1vLwa9QcdGbvVC") %>%
  add_audio_analysis() %>%
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) %>%
  mutate(pitches = map(pitches, compmus_normalise, "clr")) %>%
  mutate_at(vars(pitches, timbre), map, bind_rows) %>%
  unnest(cols = c(pitches, timbre))

myCorpus_juice <-
  recipe(
    track.name ~
      danceability +
      energy +
      loudness +
      speechiness +
      acousticness +
      instrumentalness +
      liveness +
      valence +
      tempo +
      duration +
      C + `C#|Db` + D + `D#|Eb` +
      E + `F` + `F#|Gb` + G +
      `G#|Ab` + A + `A#|Bb` + B +
      c01 + c02 + c03 + c04 + c05 + c06 +
      c07 + c08 + c09 + c10 + c11 + c12,
    data = myCorpus
  ) %>%
  step_center(all_predictors()) %>%
  step_scale(all_predictors()) %>% 
  # step_range(all_predictors()) %>% 
  prep(myCorpus %>% mutate(track.name = str_trunc(track.name, 20))) %>%
  juice() %>%
  column_to_rownames("track.name")


corpus_dist <- dist(myCorpus_juice, method = "euclidean")

# complete
corpus_dist %>% 
  hclust(method = "complete") %>% # Try single, average, and complete.
  dendro_data() %>%
  ggdendrogram()


```


### Tempograms: 'Rani' vs 'Yaad Kiya Dil Ne'

#### Rani - Tempogram
```{r, echo=FALSE}
rani <- get_tidy_audio_analysis("5d1IthC1D1CaajaQ0Vh8s3")
rani %>%
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) %>%
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

#### Yaad Kiya Dil ne - Tempogram
```{r, echo=FALSE}
yaadKiya <- 
  get_tidy_audio_analysis("4SIyELnEXAxSzXbWQ5MorW")
yaadKiya %>%
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) %>%
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

***

The tempograms between the two songs are extremely different - suggesting that the beats and experimental sounds in the remixed version of the old Bollywood song does have a significant impact. However, what is interesting is that the general pattern seen in the song 'Yaad Kiya Dil Ne' is reflected in the tempogram for the song 'Rani' (which uses 'Yaad Kiya Dil Ne' and adds a lot of experimental sounds to it). This can be seen in the following time ranges in 'Rani': (1) between 0 - 30 seconds, (2) 110-135 seconds, (3) 165-180 seconds and (4) at the very end; 

In the song Rani, after 40 seconds, larger beat drop sounds start, which might influence the tempogram. The tempo in Yaad Kiya Dil Ne and Rani in the first 30 seconds though is rather similar. At around 120 seconds, Yaad Kiya Dil Ne shows up in the Rani song, which could explain the similarity of tempo there as well. The similar pattern is seen at 165-185 seconds. After that, beat drops and other sounds dominate. At the end, once again, the old school Bollywood film sound is faintly heard, which explains why the end of the tempograms possibly have similar patterns. Overall, there are reasons why these tempograms make sense, and it allows us to visualise where Rani has drawn from Yaad Kiya Dil Ne, which is very interesting. 


### MALFNKTN's 'Rani' & influences from Old Bollywood film music


```{r, include=FALSE}
rani <- 
  get_tidy_audio_analysis("5d1IthC1D1CaajaQ0Vh8s3") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

yaadKiya <- 
  get_tidy_audio_analysis("4SIyELnEXAxSzXbWQ5MorW") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

dtwMalf <- compmus_long_distance(
  rani %>% mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  yaadKiya %>% mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) %>%
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Rani", y = "Yaad Kiya Dil Ne") +
  theme_minimal() +
  scale_fill_viridis_c(guide = NULL)
```

```{r, echo=FALSE}
dtwMalf
```

***

MALFNKTION's (an Indie Indian artist) album *Hindustani Rascal* is a fusion of Trap, Electronic music and classic 
Indian films (music from this movie is also a part of my corpus). It would be interesting to compare the songs from the album and classic Indian film music to see what common strands exist, and where MALFNKTION might be drawing influence from. 

The first comparison will be made by comparing two songs: 
(1)**Rani** by MALFNKTION (which remixes an old Indian film song,*Yaad Kiya Dil Ne*), and
(2) **Yaad Kiya Dil Ne** by Lata Mangeshkar & Hemant Kumar

By using Dynamic Time Warping, these two songs were compared.Unfortunately, the Dynamic Time Warping does not yield very significant results visually, and it is hard to make any interpretations from it. 


### *Chordogram Comparison*: 'Rani' & 'Yaad Kiya Dil Ne'

```{r, include=FALSE}
circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )


rani <-
  get_tidy_audio_analysis("5d1IthC1D1CaajaQ0Vh8s3") %>%
  compmus_align(sections, segments) %>%
  select(sections) %>%
  unnest(sections) %>%
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )

yaadKiya <- get_tidy_audio_analysis("4SIyELnEXAxSzXbWQ5MorW") %>%
  compmus_align(sections, segments) %>%
  select(sections) %>%
  unnest(sections) %>%
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )

raniChord <- rani %>% 
  compmus_match_pitch_template(chord_templates, method = "euclidean",norm = "manhattan") %>%
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(title = "'Rani' - Chordogram", x = "Time (s)", y = "")

yaadKiyaChord <- yaadKiya %>% 
  compmus_match_pitch_template(chord_templates, method = "euclidean",norm = "manhattan") %>%
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(title = "'Yaad Kiya Dil Ne' - Chordogram", x = "Time (s)", y = "")

```

#### Chordogram: 'Rani'
```{r, echo=FALSE}
raniChord
```

#### Chordogram: 'Yaad Kiya Dil Ne'
```{r, echo=FALSE}
yaadKiyaChord
```

***
The aim here was essentially to compare the chordograms of the two songs - Rani & Yaad Kiya Dil Ne and see if there were commonalities at the level of chords. There were issues with finding similarities through dynamic time warping, so maybe going into the lower level features manually to explore similarities might yield some results.

The chordograms show that there are similarities between the two songs at C minor and Eb major, since both have strong yellow shades in the chordograms. However, in general, the magnitudes are higher in the old Hindi song Yaad Kiya Dil Ne rather than the remixed experimental song, Rani, which may be attributable to the fact that Rani includes hints of this old song and has a lot of additional beats and such that are not in the original old song. The old song, Yaad Kiya Dil Ne, has more harmony than Rani and that could be represented by the higher magnitudes (brighter colours) in the chordogram for Yaad Kiya Dil Ne.


### Zooming into 'Rani': *Self-Similarity Matrix*

```{r, include=FALSE}

rani <-
  get_tidy_audio_analysis("5d1IthC1D1CaajaQ0Vh8s3") %>%
  compmus_align(bars, segments) %>%           
  select(bars) %>%                                
  unnest(bars) %>%                                
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"      
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              
      )
  )

selfsimRani <- rani %>%
  compmus_self_similarity(timbre, "cosine") %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")

```


```{r, echo=FALSE}
selfsimRani
```

***

However, it would be very interesting to go more-in-depth into MALFNKTION's song **Rani**, since it is a rather experimental piece in terms of the fusion of old Indian vocals (and that sound from last century) and beats thrown in by this artist.A self-similarity matrix (based on timbre) has been used to understand the song in more detail.

In a self-similarity matrix, yellow shows the difference and more blue shows similarity. Very slight hints of yellow are seen in the self-similarity matrix, indicating a lot of similarity within the song. This is a bit strange to me, given that there is a clash between the beats in the song and the old Hindi film music - they have a completely different timbre. The beats have a sharper sound, while the old Indian film music has a very grainy typical old-school sound. It could perhaps be the issue that the Spotify API does not catch this, given that it works best with Western pop music. This could be one potential shortcoming of the API. 


### Zooming into 'Rani': *Cepstrograms*


```{r, include=FALSE}
rani <-
  get_tidy_audio_analysis("5d1IthC1D1CaajaQ0Vh8s3") %>%
  compmus_align(bars, segments) %>%           
  select(bars) %>%                                
  unnest(bars) %>%                                
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"      
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              
      )
  )

cepsRani <- rani %>%
  compmus_gather_timbre() %>%
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +                              
  theme_classic()

```

```{r, echo=FALSE}
cepsRani
```

***
To further delve into the timbre of the music, I will now use a cepstrogram, which banks on 12 filters that Spotify uses. This could either reveal some interesting details about the song, or confirm whether or not the API is lacking in this matter. 

The cepstrogram reveals that most amount of difference show up in the third (and second) filter. 

(Not sure how to interpret these filters)


### LIFAFA vs. the Old Bollywood Film crew

One of the focuses of my corpus is also more in-depth analysis of the artist Lifafa, who is also very experimental, much like MALFNKTN. His crooner-like voice matches artists from the old Bollywood film era, and Lifafa himself has mentioned these influences when speaking about his music. In particular he mentions: ....

*[insert comparison of Lifafa's music & music by his influences from the Old Bollywood Film scene]*


### Zooming into LIFAFA's album 'Jaago'


```{r, include = FALSE}
corpusFeatures <- get_playlist_audio_features("", "7l1Hjd37s4prdAjNAnWwZM")

# Jaago features
jaago <- corpusFeatures %>% 
  filter(track.album.name == "Jaago")

# Plot
songLabels <- c("Nikamma", "Mere Saath", "Jaago", "Candy", "MRJH")

jaago_plot <- ggplot(jaago, aes(x = acousticness, 
                  y = danceability, 
                  size = loudness, 
                  colour = valence)) +
  geom_point() +
  geom_rug(size = 0.1) +
  theme_get() +             
  labs(                       
    title = "Comparison of songs in Lifafa's album 'Jaago'",
    x = "Acousticness",
    y = "Danceability",
    color = "Valence",
    size = "Loudness"
  ) +
  geom_text(
    aes(acousticness, danceability, label = songLabels),
    size = 3, nudge_x = 0.06, nudge_y = -0.025
  )
```
  
```{r, echo=FALSE}
jaago_plot
```

***

I now zoom into Lifafa's album independently to see what makes it what it is. I analyse Lifafa's album Jaago and the songs in it by comparing their danceability and acousticness, and trying to identify if there is any relation between the two. Additionally, I also looked at the valence and the loudness of the songs. It would be interesting to see how Spotify classifies valence and how I perceive the valence of Lifafa's songs, and see what makes up this number.

It is interesting to see how MRJH lies as an outlier compared to the other songs in the album, and has a much lower acousticness and danceability. Yet, valence wise, it matches Nikamma. It would be interesting to consequently compare the popularity of the songs and see what elements of Lifafa's songs appeal to the audience. However, there was missing data for two songs.

In general, it appears that there is a consistent trend of loudness in Lifafa's songs, although Candy lies as an outlier in this case. It is interesting how Lifafa is able to manipulate different features, yet have similarities between his songs (e.g. MRJH being an outlier otherwise but having similar valence to Nikamma OR Candy and Jaago having the same valence but very varying loudness')

Lifafa's compositions are unique in their own way and it's interesting to see the variety - but also the similarities. To me as a listener, I felt that there were more differences, but this graph shows me how much there is in common as well (and that is more than I initially expected)


### LIFAFA Comparison: *'Nikamma'* and *'Candy'* through *Chromagrams*

##### Nikamma - a chromagram

```{r, include = FALSE}
nikamma <-
    get_tidy_audio_analysis("0yrCxEoGU4cV3CGr0sc65J") %>%
    select(segments) %>%
    unnest(segments) %>%
    select(start, duration, pitches)
  
nikammaChromagram <- nikamma %>%
    mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
    compmus_gather_chroma() %>% 
    ggplot(
      aes(
        x = start + duration / 2,
        width = duration,
        y = pitch_class,
        fill = value
      )
    ) +
    geom_tile() +
    labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
    theme_minimal() +
    scale_fill_viridis_c()
```

```{r, echo=FALSE}
nikammaChromagram
```

##### Candy - a chromagram

```{r, include = FALSE}
candy <-
  get_tidy_audio_analysis("3eNVm12Ns8BOk4NqgWcGI4") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

candyChromagram <- candy %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```

```{r}
candyChromagram
```

***

Lifafa's songs, 'Nikamma' and 'Candy' vary quite a lot in terms of valence and loudness. To assess what might be going on, I present a comparison of their chromagrams. The `euclidean` norm has been used for the chroma vectors. 


### *LIFAFA* ('Jaago') & *MALFNKTN* ('Hindustani Rascal'): A comparison of experimental indie artists

Lifafa's album *Jaago* and MALFNKTN's album *Hindustani Rascal* are both rather experimental - they both draw some inspiration from some old school Hindi music, and at the same time, add their own beats, instruments, etc, which is quite unique to them and makes for interesting comparisons. 

I intend to create track-level summaries wherein tracks from both albums are compared on multiple levels and features. 


### Discussion



